{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "config:recommended",
    "docker:enableMajor", // Enable docker major version upgrades
    ":preserveSemverRanges", // Update SemVer ranges
    ":skipStatusChecks", // Just merge without waiting for tests (if we don't have tests or don't care)
    ":automergeMinor" // We want to merge all minor and patches
  ],
  "automergeSchedule": ["* 0-6 * * 6"], // IMPORTANT: This needs to match GitHub Actions schedule which run in UTC (renovate without timezone also runs UTC)
  // We simply automerge everything via commits in one fell swoop!
  "enabledManagers": ["custom.regex", "dockerfile", "github-actions"],
  "packageRules": [
    {
      // We should keep our docker images up to date automatically
      "groupName": "github-actions",
      "matchManagers": ["github-actions"],
      "matchUpdateTypes": ["major", "minor", "patch", "pin", "digest", "pinDigest"],
      "automergeType": "branch",
      "automerge": true
    },
    {
      // We should keep our docker images up to date automatically
      "groupName": "docker",
      "matchManagers": ["dockerfile", "custom.regex"],
      "matchUpdateTypes": ["minor", "patch", "pin", "digest", "pinDigest"],
      "automergeType": "branch",
      "automerge": true
    },
    {
      // Disable any major Docker upgrades as that should be done manually
      "enabled": false,
      "matchUpdateTypes": ["major"],
      "matchManagers": ["dockerfile"]
    }
  ],
  "customManagers": [
    {
      // TODO: Currently this "only" updates the version of the GitHub release, however if the version is ALSO in the
      // filename, this will NOT be updated.
      "customType": "regex",
      "managerFilePatterns": ["/(?:.*\\.)?Dockerfile/"],
      // TODO: Figure out if this also works when the second line does NOT match...
      "matchStrings": [
        // The first line update the release itself
        "https://github.com/(?<depName>[^/]*/[^/]*)/releases/download/v?(?<currentValue>[0-9.]+)/",
        // The second line updates the version number WITHIN the filename
        "https://github.com/(?<depName>[^/]*/[^/]*)/releases/download/v?[0-9.]+/[^/]*?(?<currentValue>(?:\\.?[0-9]+)+)"
      ],
      "datasourceTemplate": "github-releases"
    }
  ]
}
